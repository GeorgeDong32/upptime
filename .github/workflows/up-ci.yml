name: Up CI
on:
    issues:
        types: [closed]
jobs:
    site_down:
        name: Send site is up notification
        if: ${{ !github.event.issue.pull_request }}
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3
            - name: Install requirements
              run: |
               pip3 install -r ./Automation/requirements.txt
            - name: Send notification
              run: |
               python3 ./Automation/main.py --issue_title "âœ… Service is now up" --issue_content "**Resolved:** ${{github.event.issue.title}}"
              env:
                PUSHPLUS_TOKEN: ${{ secrets.PUSHPLUS_TOKEN }}
                SERVERCHAN_SENDKEY: ${{ secrets.SCKEY }}
                WECOM_TOKENS: ${{ secrets.WECOM_TOKENS }}
                WECOM_WEBHOOK: ${{ secrets.WECOM_WEBHOOK }}
                BARK_DEVICEKEY: ${{ secrets.BARK_DEVICEKEY }}
                FEISHU_DEVICEKEY: ${{ secrets.FEISHU_DEVICEKEY }}
            - name: Send Incident to Statuspage
              run: |
               python3 ./Automation/incident.py --token "${{secrets.AUTH_TOKEN}}" --url "${{secrets.INCIDENT_API}}" --title "${{github.event.issue.title}}" --content "${{github.event.issue.body}}" --status "resolved"